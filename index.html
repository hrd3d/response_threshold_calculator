<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Response Threshold Calculator</title>
  <link rel="icon" type="image/png" href="https://img.icons8.com/ios-filled/50/000000/calculator.png">

<style>

/* Prevent scrolling */
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

body {
  background: url("christmas.png") center/cover no-repeat fixed;
  color: #E0E0E0;
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  padding: 0;
}

/* Center container always */
.container {
  background: rgba(17, 24, 39, 0.85);
  backdrop-filter: blur(5px);
  padding: 30px 40px;
  border-radius: 20px;
  box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
  text-align: center;
  display: inline-block;
  white-space: nowrap;
  max-width: 95vw;
  position: relative;
  z-index: 10;
}

.title-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 25px;
  margin-bottom: 15px;
}

.title-row img {
  height: 90px;
  width: auto;
}

h1 {
  font-size: 36px;
  text-shadow: 2px 2px 6px rgba(0,0,0,0.6);
  margin: 0;
  padding: 0;
  white-space: nowrap;
}

input {
  text-align: center;
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
  font-size: 15px;
  background-color: #374151;
  color: #ffffff;
}

#result {
  margin-top: 20px;
  font-size: clamp(10px, 1.2vw, 14px);
  color: #A5F3FC;
  text-align: left;
  line-height: 1.5;
}

/* Notification â€” always bottom center */
.notification {
  position: fixed;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #22c55e;
  color: #fff;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  opacity: 0;
  transition: opacity 0.4s ease-in-out;
  z-index: 999999 !important;
  white-space: nowrap;
}

.notification.show {
  opacity: 1;
}

.notification.error {
  background-color: #ef4444;
}

.notification.warning {
  background-color: #facc15;
  color: #7a1d0f;
}

.copy-btn {
  background: none;
  border: none;
  cursor: pointer;
  margin-right: 8px;
  font-size: 20px;
  color: #38bdf8;
}

.copy-btn:hover {
  color: #0ea5e9;
}

/* Shake on invalid */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
}

.shake {
  animation: shake 0.4s ease-in-out;
}

/* Snow canvas */
#snowCanvas {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 0;
}

</style>
</head>

<body>

<canvas id="snowCanvas"></canvas>

<div class="container">
<div class="title-row" style="flex-direction: column; gap: 10px;">
  <img src="shop.png">
  <h1>Response Threshold Calculator</h1>
</div>

<p>Enter time in format: HH:MM:SS to HH:MM:SS</p>
<input type="text" id="timeRange" placeholder="e.g., 10:53:20 to 10:55:43" />
<div id="result"></div>
</div>

<!-- SINGLE Notification element (centered) -->
<div id="notification" class="notification"></div>

<script>
let lastInput = "";

function parseTimeString(timeStr) {
  const [h, m, s] = timeStr.split(':').map(Number);
  return (h * 3600) + (m * 60) + s;
}

function formatTimeDiff(seconds) {
  if (seconds <= 0) return "0sec";
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  let result = "";
  if (mins > 0) result += `${mins}min${mins > 1 ? 's' : ''}`;
  if (secs > 0) result += (mins > 0 ? ' and ' : '') + `${secs}sec${secs > 1 ? 's' : ''}`;
  return result;
}

function showNotification(message, type = "success") {
  const note = document.getElementById("notification");
  note.className = "notification";
  note.textContent = message;

  if (type === "error") note.classList.add("error");
  if (type === "warning") note.classList.add("warning");

  note.classList.add("show");

  setTimeout(() => {
    note.classList.remove("show");
  }, 4000);
}

function addCopyButtons() {
  const resultDiv = document.getElementById("result");
  const paragraphs = resultDiv.querySelectorAll("p");
  paragraphs.forEach(p => {
    if (!p.querySelector("button")) {
      const text = p.innerText;
      const btn = document.createElement("button");
      btn.innerHTML = "ðŸ“‹";
      btn.className = "copy-btn";
      btn.onclick = () => {
        navigator.clipboard.writeText(text).then(() => {
          showNotification("Copied!");
        });
      };
      p.prepend(btn);
    }
  });
}

document.getElementById('timeRange').addEventListener('keydown', function(event) {
  const inputBox = this;
  if (event.key === 'Enter') {
    const input = this.value.trim();

    if (input === lastInput) {
      showNotification("Same result found. Enter a new timestamp.", "warning");
      return;
    }

    const parts = input.split(' to ').map(p => p.trim());
    if (
      parts.length !== 2 ||
      !/^\d{2}:\d{2}:\d{2}$/.test(parts[0]) ||
      !/^\d{2}:\d{2}:\d{2}$/.test(parts[1])
    ) {
      document.getElementById('result').innerText = "âš ï¸Invalid response threshold format!";
      inputBox.classList.add('shake');
      setTimeout(() => inputBox.classList.remove('shake'), 400);
      showNotification("Failed! Check HH:MM:SS to HH:MM:SS format", "error");
      return;
    }

    const diff = (parseTimeString(parts[1]) - parseTimeString(parts[0]) + 86400) % 86400;
    const resultText = formatTimeDiff(diff);
    const color = diff <= 150 ? "green" : "red";

    document.getElementById('result').innerHTML = `
          <div style='margin-bottom: 10px; font-size: 30px; color: ${color}; text-align: center; font-family: arial; font-weight: bold;'>${resultText}</div>
          <div>
            <p>Response threshold/GBE10 - The agent failed the 15-sec response threshold from ${parts[0]} to ${parts[1]} (${resultText}).</p>
            <p>Response threshold/GBE10 - The agent failed the 2-min response threshold from ${parts[0]} to ${parts[1]} (${resultText}).</p>
            <p>Response threshold/GBE10 - The agent also failed the 2-min response threshold from ${parts[0]} until chat ended (due to user inactivity) on ${parts[1]} (${resultText}).</p>
            <p>Response threshold/GBE10 - The agent also failed the 2-min response threshold from ${parts[0]} until chat ended (due to chat ended by user) on ${parts[1]} (${resultText}).</p>
            <p>Response threshold/GBE10 - The agent also failed the 2-min response threshold from ${parts[0]} until chat ended (due to timeout/agent inactivity) on ${parts[1]} (${resultText}).</p>
            <p>Hold SOP/GBE08 - The agent failed to get back to the user within 2-min response threshold from ${parts[0]} to ${parts[1]} (${resultText}) after placing the chat on hold.</p>
          </div>`;

    addCopyButtons();
    showNotification("Success!");
    lastInput = input;
  }
});
</script>

<script>
// Snow animation
const canvas = document.getElementById("snowCanvas");
const ctx = canvas.getContext("2d");
let w, h;
let snowflakes = [];

function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function newSnowflake() {
  return {
    x: Math.random() * w,
    y: Math.random() * -70,
    r: Math.random() * 4 + 4,
    s: Math.random() * 2 + 4,
  };
}

function updateSnow() {
  ctx.clearRect(0, 0, w, h);
  if (snowflakes.length < 200) snowflakes.push(newSnowflake());

  snowflakes.forEach((f, i) => {
    f.y += f.s;
    if (f.y > h) snowflakes[i] = newSnowflake();
    ctx.beginPath();
    ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
    ctx.fillStyle = "white";
    ctx.fill();
  });
  requestAnimationFrame(updateSnow);
}
updateSnow();
</script>

</body>
</html>
